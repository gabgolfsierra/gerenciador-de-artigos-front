<section class="page">
  <div class="card">
    <header class="toolbar">
      <div class="title">
        <h1>Artigos</h1>
        <span class="badge">{{ artigos?.length || 0 }}</span>
      </div>
      <button (click)="fetch()" class="btn btn-primary" aria-label="Recarregar lista">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 6v3l4-4-4-4v3a8 8 0 1 0 8 8h-2a6 6 0 1 1-6-6z"/>
        </svg>
        Recarregar
      </button>
    </header>

    <div *ngIf="loading" class="status">
      <div class="spinner" aria-hidden="true"></div>
      Carregando…
    </div>

    <div *ngIf="!loading && errorMsg" class="alert">
      {{ errorMsg }}
    </div>

    <div class="table-wrap" *ngIf="!loading && !errorMsg">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Título</th>
            <th>Autor</th>
            <th>Coautor</th>
            <th>Ano</th>
            <th>DOI</th>
            <th>Idioma</th>
            <th>Instituição</th>
            <th>Orientador</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let art of artigos" class="row">
            <td class="muted">{{ art.id }}</td>
            <td class="strong ellipsis" title="{{ art.titulo }}">{{ art.titulo }}</td>
            <td>{{ pessoaNome(art.autor) }}</td>
            <td>{{ pessoaNome(art.coautor) }}</td>
            <td class="mono">{{ art.anoPublicacao }}</td>
            <td class="ellipsis">
              <ng-container *ngIf="art.doi as d; else dash">
                <a *ngIf="d?.startsWith('http'); else plainDoi"
                   [href]="d" target="_blank" rel="noopener">
                  {{ d }}
                </a>
                <ng-template #plainDoi>{{ d || '—' }}</ng-template>
              </ng-container>
              <ng-template #dash>—</ng-template>
            </td>
            <td>
              <span class="chip" *ngIf="art.idioma; else dash"> {{ art.idioma }} </span>
            </td>
            <td class="ellipsis" title="{{ art.instituicao }}">{{ art.instituicao || '—' }}</td>
            <td>{{ pessoaNome(art.orientador) }}</td>
          </tr>

          <tr *ngIf="artigos.length === 0">
            <td colspan="9">
              <div class="empty">
                <svg class="icon-lg" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M19 3H5a2 2 0 0 0-2 2v14l4-4h12a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/>
                </svg>
                <p>Nenhum artigo encontrado.</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</section>
